name: Initial Deployment Pipeline
on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  integration:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: echo "- Lint the code and run unit tests"
        
  build:
    needs: integration
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: echo "- Build the artifact"

  test-artifact:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: echo "- Simulate and test the artifact"

  development:
    needs : test-artifact
    runs-on: ubuntu-latest
    steps:
      - run: echo "- Auto-deploy the artifact to the development environment"
        
  staging:
    needs: test-artifact
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "After development envirionment is deployed..."
          echo "and after the artifact tests have passed..."
          echo "- Auto-deploy the artifact to the staging environment"
        
  test-staging:
    needs: staging
    runs-on: ubuntu-latest
    steps:
      - run: echo "- Test the staging environment"
        
  production:
    needs: test-staging
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "After staging envirionment is deployed..."
          echo "and after the staging tests have passed..."
          echo "require a review before deploying to the production envirionment, then..."
          echo "- Deploy the artifact to the production environment"
          echo "Trigger event: ${{ github.event_name }}"

  test-production:
    needs: production
    runs-on: ubuntu-latest
    steps:
      - run: echo "- Test the artifact in the production environment"
      - run: echo "# All tests and deployments have completed successfully!"
  print_summary:
    needs: [integration, build, test-artifact, development, staging, test-staging, production, test-production]
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "### Deployment Pipeline Summary"
          echo "- Integration job: ${{ needs.integration.result }}"
          echo "- Build job: ${{ needs.build.result }}"
          echo "- Test Artifact job: ${{ needs.test-artifact.result }}"
          echo "- Development Deployment job: ${{ needs.development.result }}"
          echo "- Staging Deployment job: ${{ needs.staging.result }}"
          echo "- Test Staging job: ${{ needs.test-staging.result }}"
          echo "- Production Deployment job: ${{ needs.production.result }}"
          echo "- Test Production job: ${{ needs.test-production.result }}" >> $GITHUB_STEP_SUMMARY
          echo "### End of Summary" >> $GITHUB_STEP_SUMMARY